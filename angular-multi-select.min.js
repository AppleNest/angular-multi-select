var angular_multi_select=angular.module("angular-multi-select",["ng","angular.filter"]);
angular_multi_select.directive("angularMultiSelect",["$sce","$timeout","$filter",function(d,h,f){return{restrict:"AE",scope:{inputModel:"=",isDisabled:"=",onClear:"&",onClose:"&",onItemClick:"&",onOpen:"&",onReset:"&",onSelectAll:"&",onSelectNone:"&",translation:"="},templateUrl:"angular-multi-select.htm",link:function(a,m,c){a._shadowModel=[];a.filteredModel=[];a.searchInput={value:""};c.idProperty=c.idProperty||"angular-multi-select-id";c.selectionMode=c.selectionMode||"multi";c.selectionMode=c.selectionMode.toLowerCase();
a.helperStatus={all:"multi"===c.selectionMode,none:"multi"===c.selectionMode,reset:!0,filter:!0};a.visible=!1;a.buttonLabel="";a.tickProperty=c.tickProperty;a.groupProperty=c.groupProperty;a.itemLabel=c.itemLabel;a._walk=function(b,c,g){if(angular.isArray(b)){var d=[];angular.forEach(b,function(b){b=a._walk(b,c,g);null!==b&&d.push(b)});return 0<d.length?d:null}if(angular.isObject(b)){g=g||function(){return!0};var k=g(b);if(b.hasOwnProperty(c)&&angular.isArray(b[c])){var l=[];angular.forEach(b[c],
function(b){b=a._walk(b,c,g);null!==b&&l.push(b)});l.length!==b[c].length&&(b[c]=l);k=0<l.length}return k?b:null}};a._syncModels=function(b,e){a._walk(e,c.groupProperty,function(e){a._walk(b,c.groupProperty,function(a){a[c.idProperty]===e[c.idProperty]&&(a[c.tickProperty]=e[c.tickProperty]);return!0});return!0})};a._enforceIDs=function(b){var e=[];a._walk(b,c.groupProperty,function(a){if(!1===a.hasOwnProperty(c.idProperty)||-1!==e.indexOf(a[c.idProperty]))a[c.idProperty]=Math.floor(1E8*Math.random()+
1);e.push(a[c.idProperty]);return!0})};a._getParent=function(b,e){var g=null,d=!1,k=null;a._walk(b,c.groupProperty,function(b){if(!0===d)return!0;0<a._hasChildren(b,!1)&&b[c.idProperty]!==e[c.idProperty]&&(k=b);b[c.idProperty]===e[c.idProperty]&&(g=k,d=!0);return!0});return g};a._getLeafs=function(b){var e=[];a._walk(b,c.groupProperty,function(b){0===a._hasChildren(b,!1)&&e.push(b);return!0});return e};a._getNodes=function(b){var e=[];a._walk(b,c.groupProperty,function(b){0<a._hasChildren(b,!1)&&
e.push(b);return!0});return e};a._hasChildren=function(b,e){if(!1===(e||!1)&&b.hasOwnProperty(c.groupProperty)&&angular.isArray(b[c.groupProperty])&&0<b[c.groupProperty].length)return 1;var d=-1;a._walk(b,c.groupProperty,function(){d++;return!0});return d};a._isChecked=function(a){return!(!a.hasOwnProperty(c.tickProperty)||!0!==a[c.tickProperty])};a._areAllChecked=function(b){var e=0,d=0;a._walk(b,c.groupProperty,function(b){0===a._hasChildren(b,!1)&&(a._isChecked(b)&&e++,d++);return!0});return d===
e?e:0<e?-e:0};a._enforceChecks=function(b){var e=0,d=a._getLeafs(b),f=!1;angular.forEach(d,function(d){!0!==f&&(a._isChecked(d)&&e++,1<e&&"single"===c.selectionMode&&(f=!0,a._uncheckAll(b)))});!0!==f&&(d=a._getNodes(b),angular.forEach(d,function(b){b[c.tickProperty]=0!==a._areAllChecked(b)}))};a._flipCheck=function(b){if(0<a._hasChildren(b)){var e=!(0<a._areAllChecked(b));a._walk(b,c.groupProperty,function(a){a[c.tickProperty]=e;return!0})}else b[c.tickProperty]=!a._isChecked(b)};a._uncheckAll=function(b){a._walk(b,
c.groupProperty,function(a){a[c.tickProperty]=!1;return!0})};a.clickItem=function(b){"single"!==c.selectionMode||0===a._areAllChecked(a._shadowModel)||(0===a._hasChildren(b,!1)||1===a._hasChildren(b))&&a._isChecked(b)||(a._uncheckAll(a._shadowModel),a._uncheckAll(a.filteredModel));a._flipCheck(b);a._enforceChecks(a.filteredModel);h(function(){a.onItemClick({data:angular.copy(b)})},0)};a._filter=function(b){if(void 0===a.searchInput.value||""===a.searchInput.value)return!0;b=angular.extend({},b);b[c.itemLabel]=
f("latinize")(b[c.itemLabel]);var d=a.searchInput.value,d=f("latinize")(d);return 0<f("fuzzyBy")([b],c.itemLabel,d).length};a.fillShadowModel=function(){a._shadowModel=angular.copy(a.inputModel);a._enforceIDs(a._shadowModel);a._enforceChecks(a._shadowModel);a.fillFilteredModel()};a.fillFilteredModel=function(){a.filteredModel=angular.copy(a._shadowModel);a.filteredModel=a._walk(a.filteredModel,c.groupProperty,a._filter)};a.$watch("filteredModel",function(b){b&&(b=Math.abs(a._areAllChecked(a.filteredModel)),
a.buttonLabel=b+" selected",a.buttonLabel=d.trustAsHtml(a.buttonLabel+'<span class="caret"></span>'),a._syncModels(a._shadowModel,a.filteredModel))},!0);a.$watch("searchInput.value",function(b,c){angular.equals(b,c)||a.fillFilteredModel()});a.$watch("visible",function(b,c){angular.equals(b,c)||!0!==b?angular.equals(b,c)||!1!==b||(a.stopListeningMouseEvents(),a.stopListeningMouseEvents=null,a.stopListeningKeyboardEvents(),a.stopListeningKeyboardEvents=null):(a.stopListeningMouseEvents=a.$on("angular-multi-select-click",
function(b,c){var d=!1;angular.forEach($(c.event.target).parents(),function(a){!0!==d&&void 0!==$(a).attr("angular-multi-select")&&(d=!0)});!1===d&&(a.visible=!1,a.$apply())}),a.stopListeningKeyboardEvents=a.$on("angular-multi-select-keydown",function(a,b){console.log("kb!")}))});a.fillShadowModel();a.lang={};a.directiveId=c.directiveId;"undefined"!==typeof c.maxHeight&&(m=m.children().children().children()[0],angular.element(m).attr("style","height:"+c.maxHeight+"; overflow-y:scroll;"));a.icon={};
a.icon.selectAll="&#10003;";a.icon.selectNone="&times;";a.icon.reset="&#8630;";a.icon.tickMark="&#10003;";"undefined"!==typeof c.translation?(a.lang.selectAll=d.trustAsHtml(a.icon.selectAll+"&nbsp;&nbsp;"+a.translation.selectAll),a.lang.selectNone=d.trustAsHtml(a.icon.selectNone+"&nbsp;&nbsp;"+a.translation.selectNone),a.lang.reset=d.trustAsHtml(a.icon.reset+"&nbsp;&nbsp;"+a.translation.reset),a.lang.search=a.translation.search,a.lang.nothingSelected=d.trustAsHtml(a.translation.nothingSelected)):
(a.lang.selectAll=d.trustAsHtml(a.icon.selectAll+"&nbsp;&nbsp;Select All"),a.lang.selectNone=d.trustAsHtml(a.icon.selectNone+"&nbsp;&nbsp;Select None"),a.lang.reset=d.trustAsHtml(a.icon.reset+"&nbsp;&nbsp;Reset"),a.lang.search="Search...",a.lang.nothingSelected="None Selected");a.icon.tickMark=d.trustAsHtml(a.icon.tickMark)}}}]);angular_multi_select.directive("angularMultiSelectKeyTrap",function(){return function(d,h){h.bind("keydown",function(f){d.$broadcast("angular-multi-select-keydown",{event:f})})}});
angular_multi_select.directive("angularMultiSelectMouseTrap",function(){return function(d,h){h.bind("click",function(f){d.$broadcast("angular-multi-select-click",{event:f})})}});angular_multi_select.directive("setFocus",function(d){return function(h,f,a){h.$watch(a.setFocus,function(a){d(function(){a&&f.focus()})},!0)}});angular_multi_select.run(["$templateCache",function(d){d.put("angular-multi-select-item.htm","<div class='multiSelectItem' ng-click='clickItem(item);' ng-class='{selected: item[tickProperty], multiSelectGroup:_hasChildren(item, false) > 0}'>{{ item[itemLabel] }}<span class=\"tickMark\" ng-if=\"item[tickProperty] === true\" ng-bind-html=\"icon.tickMark\"></span></div><ul ng-if='item.sub'><li ng-repeat='item in item[groupProperty]' ng-include=\"'angular-multi-select-item.htm'\" ></li></ul>")}]);
angular_multi_select.run(["$templateCache",function(d){d.put("angular-multi-select.htm",'<span class="multiSelect inlineBlock"><button id="{{directiveId}}" type="button"ng-click="visible = !visible"ng-bind-html="buttonLabel"ng-disabled="disable-button"></button><div class="checkboxLayer" ng-show="visible"><div class="helperContainer" ng-if="helperStatus.filter || helperStatus.all || helperStatus.none || helperStatus.reset "><div class="line" ng-if="helperStatus.all || helperStatus.none || helperStatus.reset "><button type="button" class="helperButton"ng-disabled="isDisabled" ng-if="helperStatus.all" ng-click="" ng-bind-html="lang.selectAll"></button><button type="button" class="helperButton"ng-disabled="isDisabled" ng-if="helperStatus.none" ng-click="" ng-bind-html="lang.selectNone"></button><button type="button" class="helperButton reset"ng-disabled="isDisabled" ng-if="helperStatus.reset" ng-click="fillShadowModel()" ng-bind-html="lang.reset"></button></div><div class="line" style="position:relative" ng-if="helperStatus.filter"><input placeholder="{{ lang.search }}" type="text"ng-model="searchInput.value" class="inputFilter" set-focus="visible"/><button type="button" class="clearButton" ng-click="searchInput.value = \'\'" >\u00d7</button> </div> </div> <div class="checkBoxContainer"><ul><li ng-repeat=\'item in filteredModel\' ng-include="\'angular-multi-select-item.htm\'"></li></ul></div></div></div></span>')}]);
