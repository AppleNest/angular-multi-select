var A=angular.module("angular-multi-select",["ng"]);
A.directive("angularMultiSelect",["$sce","$timeout","$templateCache",function(m,v){return{restrict:"AE",scope:{c:"=",h:"=",C:"=",$:"&",R:"&",da:"&",aa:"&",ba:"&",ca:"&",ea:"&",fa:"&",B:"="},templateUrl:"angular-multi-select.htm",link:function(a,h,c){function B(){a.$apply(function(){a.ja=!0})}function C(){a.$apply(function(){a.ja=!1})}a.M=[];a.j="";a.A="";a.i="";a.S=!1;a.T=!0;a.a=[];a.m={o:""};a.tabIndex=0;a.lang={};a.g={all:!0,P:!0,reset:!0,filter:!0};var p=0,u=[],q=0,n="",f=[],x=0,r=null;a.la=function(b){a.m.o=
"";a.I();a.select("clear",b)};a.pa=function(a){return Array(a)};a.ra=function(){if(a.m.o.length<x&&0<a.m.o.length)return!1;a.I()};a.I=function(){a.a=[];var b,e;if("undefined"!==typeof a.c){for(b=a.c.length-1;0<=b;b--){"undefined"!==typeof a.c[b][c.b]&&!1===a.c[b][c.b]&&a.a.push(a.c[b]);var d=!1;if("undefined"===typeof a.c[b][c.b]){if("undefined"!==typeof c.U&&""!==c.U)for(e in a.c[b]){if("boolean"!==typeof a.c[b][e]&&0<=String(a.c[b][e]).toUpperCase().indexOf(a.m.o.toUpperCase())&&-1<c.U.indexOf(e)){d=
!0;break}}else for(e in a.c[b])if("boolean"!==typeof a.c[b][e]&&0<=String(a.c[b][e]).toUpperCase().indexOf(a.m.o.toUpperCase())){d=!0;break}!0===d&&a.a.push(a.c[b])}"undefined"!==typeof a.c[b][c.b]&&!0===a.c[b][c.b]&&("undefined"!==typeof a.a[a.a.length-1][c.b]&&!1===a.a[a.a.length-1][c.b]?a.a.pop():a.a.push(a.c[b]))}a.a.reverse();v(function(){a.N();if(a.m.o.length>x){var b=[];angular.forEach(a.a,function(d){"undefined"!==typeof d&&"undefined"===typeof d[c.b]&&(d=angular.copy(d),d=b.push(d),delete b[d-
1][a.i],delete b[d-1][a.A])});a.da({data:{oa:a.m.o,result:b}})}},0)}};a.N=function(){f=[];var b,c=[],d=[],y=[],l=[];a.g.all||a.g.P||a.g.reset?(c=h.children().children().next().children().children()[0].getElementsByTagName("button"),a.g.filter&&(d=h.children().children().next().children().children().next()[0].getElementsByTagName("input"),l=h.children().children().next().children().children().next()[0].getElementsByTagName("button"))):a.g.filter&&(d=h.children().children().next().children().children()[0].getElementsByTagName("input"),
l=h.children().children().next().children().children()[0].getElementsByTagName("button"));y=a.g.all||a.g.P||a.g.reset||a.g.filter?h.children().children().next().children().next()[0].getElementsByTagName("input"):h.children().children().next()[0].getElementsByTagName("input");for(b=0;b<c.length;b++)f.push(c[b]);for(b=0;b<d.length;b++)f.push(d[b]);for(b=0;b<l.length;b++)f.push(l[b]);for(b=0;b<y.length;b++)f.push(y[b])};a.ma=function(a,e){return!("undefined"===typeof a[c.b]||a[c.b]!==e)};a.qa=function(a){return!("undefined"!==
typeof a[c.b]&&!1===a[c.b])};a.sa=function(b,e,d){e.preventDefault();e.stopPropagation();if("undefined"!==typeof c.l&&!0===b[c.l]||"undefined"!==typeof c.C&&!0===a.C||"undefined"!==typeof b[c.b]&&!1===b[c.b])return!1;var f=a.a.indexOf(b),l;if("undefined"!==typeof b[c.b]&&!0===b[c.b]){if("undefined"!==typeof c.s&&"SINGLE"===c.s.toUpperCase())return!1;var k,g,h=0,m=a.a.length-1,n=[],t=0;for(k=f;k<a.a.length&&!(0===t&&k>f);k++)if("undefined"!==typeof a.a[k][c.b]&&!0===a.a[k][c.b])0===n.length&&(h=k+
1),t+=1;else if("undefined"!==typeof a.a[k][c.b]&&!1===a.a[k][c.b]){if(--t,0<n.length&&0===t){l=!0;m=k;for(g=0;g<n.length;g++)if("undefined"!==typeof n[g][a.f]&&!1===n[g][a.f]){l=!1;break}if(!0===l)for(g=h;g<=m;g++)"undefined"===typeof a.a[g][c.b]&&("undefined"===typeof c.l?(a.a[g][a.f]=!1,l=a.a[g][a.i],a.c[l][a.f]=!1):!0!==a.a[g][c.l]&&(a.a[g][a.f]=!1,l=a.a[g][a.i],a.c[l][a.f]=!1));else for(g=h;g<=m;g++)"undefined"===typeof a.a[g][c.b]&&("undefined"===typeof c.l?(a.a[g][a.f]=!0,l=a.a[g][a.i],a.c[l][a.f]=
!0):!0!==a.a[g][c.l]&&(a.a[g][a.f]=!0,l=a.a[g][a.i],a.c[l][a.f]=!0))}}else n.push(a.a[k])}else{if("undefined"!==typeof c.s&&"SINGLE"===c.s.toUpperCase()){for(k=0;k<a.a.length;k++)a.a[k][a.f]=!1;for(k=0;k<a.c.length;k++)a.c[k][a.f]=!1;a.a[f][a.f]=!0}else a.a[f][a.f]=!a.a[f][a.f];l=a.a[f][a.i];a.c[l][a.f]=a.a[f][a.f]}r=angular.copy(b);null!==r&&v(function(){delete r[a.i];delete r[a.A];a.aa({data:r});r=null},0);a.v();a.u();p=a.tabIndex;a.tabIndex=d+q;e.target.focus();a.w(p);a.K(a.tabIndex);"undefined"!==
typeof c.s&&"SINGLE"===c.s.toUpperCase()&&a.W()};a.v=function(){a.h?a.h.length=0:a.h=[];var b=[],e={};"undefined"!==typeof c.ga?(b=c.ga.split(" "),angular.forEach(a.c,function(d){"undefined"!==typeof d&&"undefined"===typeof d[c.b]&&!0===d[a.f]&&(e={},angular.forEach(d,function(a,c){-1<b.indexOf(c)&&(e[c]=a)}),d=a.h.push(e),delete a.h[d-1][a.i],delete a.h[d-1][a.A])})):angular.forEach(a.c,function(b){"undefined"!==typeof b&&"undefined"===typeof b[c.b]&&!0===b[a.f]&&(b=angular.copy(b),b=a.h.push(b),
delete a.h[b-1][a.i],delete a.h[b-1][a.A])})};a.u=function(){a.j="";var b=0;if(0===a.h.length)a.j=a.lang.J;else{var e=a.h.length;"undefined"!==typeof c.O&&""!==c.O&&(e=c.O);a.Z=a.h.length>e;angular.forEach(a.c,function(d){"undefined"!==typeof d&&!0===d[c.f]&&(b<e&&(a.j+=(0<a.j.length?'</div>, <div class="buttonLabel">':'<div class="buttonLabel">')+a.ka(d)),b++)});!0===a.Z&&(0<e&&(a.j+=", ... "),a.j+="("+a.h.length+")")}a.j=m.trustAsHtml(a.j+'<span class="caret"></span>')};a.na=function(b){return"undefined"!==
typeof c.l&&!0===b[c.l]?!0:!0===a.C};a.ka=function(a){var e="";angular.forEach(c.buttonLabel.split(" "),function(c){if(a[c])e+="&nbsp;"+a[c];else if(1!==c.split(".").length){var f=c.split(".").reduce(function(a,b){return a[b]},a);e+=void 0===f?c:"&nbsp;"+f}else e+=c});return e};a.W=function(){var b=h.children()[0];angular.element(document).off("click touchstart",a.G);angular.element(document).off("keydown",a.H);if(angular.element(n).hasClass("show"))angular.element(n).removeClass("show"),angular.element(b).removeClass("buttonClicked"),
angular.element(document).off("click touchstart",a.G),angular.element(document).off("keydown",a.H),a.w(a.tabIndex),"undefined"!==typeof f[a.tabIndex]&&f[a.tabIndex].blur(),v(function(){a.R()},0),h.children().children()[0].focus();else{a.m.o="";a.I();u=[];q=0;angular.element(n).addClass("show");angular.element(b).addClass("buttonClicked");angular.element(document).on("click touchstart",a.G);angular.element(document).on("keydown",a.H);a.N();a.tabIndex=0;b=angular.element(h[0].querySelector(".helperContainer"))[0];
if("undefined"!==typeof b){for(var c=0;c<b.getElementsByTagName("BUTTON").length;c++)u[c]=b.getElementsByTagName("BUTTON")[c];q=u.length+b.getElementsByTagName("INPUT").length}h[0].querySelector(".inputFilter")?(h[0].querySelector(".inputFilter").focus(),a.tabIndex=a.tabIndex+q-2,angular.element(h).children()[0].blur()):a.C||(a.tabIndex=a.tabIndex+q,0<a.c.length&&(f[a.tabIndex].focus(),a.K(a.tabIndex),angular.element(h).children()[0].blur()));a.ba()}};a.G=function(b){for(var c=h.find(b.target.tagName),
d=0;d<c.length;d++)if(b.target==c[d])return;angular.element(n.previousSibling).removeClass("buttonClicked");angular.element(n).removeClass("show");angular.element(document).off("click touchstart",a.G);angular.element(document).off("keydown",a.H);v(function(){a.R()},0);h.children().children()[0].focus()};a.select=function(b,e){a.tabIndex=u.indexOf(e.target);switch(b.toUpperCase()){case "ALL":angular.forEach(a.a,function(b){"undefined"!==typeof b&&!0!==b[c.l]&&"undefined"===typeof b[c.b]&&(b[a.f]=!0)});
a.v();a.u();a.ea();break;case "NONE":angular.forEach(a.a,function(b){"undefined"!==typeof b&&!0!==b[c.l]&&"undefined"===typeof b[c.b]&&(b[a.f]=!1)});a.v();a.u();a.fa();break;case "RESET":angular.forEach(a.a,function(b){"undefined"===typeof b[c.b]&&"undefined"!==typeof b&&!0!==b[c.l]&&(b[a.f]=a.M[b[a.i]][a.f])});a.v();a.u();a.ca();break;case "CLEAR":a.tabIndex=a.tabIndex+1;a.$();break;case "FILTER":a.tabIndex=u.length-1}};a.ha=function(){var b=0;angular.forEach(a.a,function(e){e[a.A]=b;!0===e[c.b]?
b+=2:!1===e[c.b]&&(b-=2)})};a.ia=function(){var b=0;angular.forEach(a.a,function(c){c[a.i]=b;b++})};a.H=function(b){var c=b.keyCode?b.keyCode:b.which,d=!1;if(27===c)b.preventDefault(),b.stopPropagation(),a.W();else if(40===c||39===c||!b.shiftKey&&9==c)for(d=!0,p=a.tabIndex,a.tabIndex++,a.tabIndex>f.length-1&&(a.tabIndex=0,p=f.length-1);!0===f[a.tabIndex].disabled&&(a.tabIndex++,a.tabIndex>f.length-1&&(a.tabIndex=0),a.tabIndex!==p););else if(38===c||37===c||b.shiftKey&&9==c)for(d=!0,p=a.tabIndex,a.tabIndex--,
0>a.tabIndex&&(a.tabIndex=f.length-1,p=0);!0===f[a.tabIndex].disabled;){a.tabIndex--;if(a.tabIndex===p)break;0>a.tabIndex&&(a.tabIndex=f.length-1)}!0===d&&(b.preventDefault(),f[a.tabIndex].focus(),"CHECKBOX"===document.activeElement.type.toUpperCase()?(a.K(a.tabIndex),a.w(p)):(a.w(p),a.w(q),a.w(f.length-1)))};a.K=function(a){angular.element(f[a]).parent().parent().parent().addClass("multiSelectFocus")};a.w=function(a){angular.element(f[a]).parent().parent().parent().removeClass("multiSelectFocus")};
a.b=c.b;a.f=c.f;a.X=c.X;var w=function(a){for(var c="",d=0;d<a;d++)c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random()));return c}(5);a.i="idx_"+w;a.A="spc_"+w;"undefined"!==typeof c.orientation&&("HORIZONTAL"===c.orientation.toUpperCase()?(a.S=!0,a.T=!1):(a.S=!1,a.T=!0));n=h.children().children().next()[0];"undefined"!==typeof c.maxHeight&&(w=h.children().children().children()[0],angular.element(w).attr("style","height:"+c.maxHeight+"; overflow-y:scroll;"));
for(var z in a.g)a.g.hasOwnProperty(z)&&"undefined"!==typeof c.Y&&-1===c.Y.toUpperCase().indexOf(z.toUpperCase())&&(a.g[z]=!1);"undefined"!==typeof c.s&&"SINGLE"===c.s.toUpperCase()&&(a.g.all=!1,a.g.none=!1);a.icon={};a.icon.D="&#10003;";a.icon.F="&times;";a.icon.reset="&#8630;";a.icon.V="&#10003;";"undefined"!==typeof c.B?(a.lang.D=m.trustAsHtml(a.icon.D+"&nbsp;&nbsp;"+a.B.D),a.lang.F=m.trustAsHtml(a.icon.F+"&nbsp;&nbsp;"+a.B.F),a.lang.reset=m.trustAsHtml(a.icon.reset+"&nbsp;&nbsp;"+a.B.reset),a.lang.search=
a.B.search,a.lang.J=m.trustAsHtml(a.B.J)):(a.lang.D=m.trustAsHtml(a.icon.D+"&nbsp;&nbsp;Select All"),a.lang.F=m.trustAsHtml(a.icon.F+"&nbsp;&nbsp;Select None"),a.lang.reset=m.trustAsHtml(a.icon.reset+"&nbsp;&nbsp;Reset"),a.lang.search="Search...",a.lang.J="None Selected");a.icon.V=m.trustAsHtml(a.icon.V);"undefined"!==typeof c.L&&0<parseInt(c.L,10)&&(x=Math.floor(parseInt(c.L,10)));a.$watch("inputModel",function(b){b&&(a.v(),a.u())},!0);a.$watch("inputModel",function(b){b&&(a.M=angular.copy(a.c),
a.I(),a.ha(),a.ia(),a.v(),a.u())});a.$watch("isDisabled",function(b){a.C=b});angular.element(document).bind("touchstart",C);angular.element(document).bind("touchmove",B);a.$on("$destroy",function(){angular.element(document).unbind("touchstart",C);angular.element(document).unbind("touchmove",B)})}}}]);A.run(["$templateCache",function(m){m.put("angular-multi-select.htm",'<span class="multiSelect inlineBlock"><button id="{{directiveId}}" type="button"ng-click="toggleCheckboxes( $event ); refreshSelectedItems(); refreshButton(); prepareGrouping; prepareIndex();"ng-bind-html="varButtonLabel"ng-disabled="disable-button"></button><div class="checkboxLayer"><div class="helperContainer" ng-if="helperStatus.filter || helperStatus.all || helperStatus.none || helperStatus.reset "><div class="line" ng-if="helperStatus.all || helperStatus.none || helperStatus.reset "><button type="button" class="helperButton"ng-disabled="isDisabled"ng-if="helperStatus.all"ng-click="select( \'all\', $event );"ng-bind-html="lang.selectAll"></button><button type="button" class="helperButton"ng-disabled="isDisabled"ng-if="helperStatus.none"ng-click="select( \'none\', $event );"ng-bind-html="lang.selectNone"></button><button type="button" class="helperButton reset"ng-disabled="isDisabled"ng-if="helperStatus.reset"ng-click="select( \'reset\', $event );"ng-bind-html="lang.reset"></button></div><div class="line" style="position:relative" ng-if="helperStatus.filter"><input placeholder="{{lang.search}}" type="text"ng-click="select( \'filter\', $event )" ng-model="inputLabel.labelFilter" ng-change="searchChanged()" class="inputFilter"/><button type="button" class="clearButton" ng-click="clearClicked( $event )" >\u00d7</button> </div> </div> <div class="checkBoxContainer"><div ng-repeat="item in filteredModel | filter:removeGroupEndMarker" class="multiSelectItem"ng-class="{selected: item[ tickProperty ], horizontal: orientationH, vertical: orientationV, multiSelectGroup:item[ groupProperty ], disabled:itemIsDisabled( item )}"ng-click="syncItems( item, $event, $index );" ng-mouseleave="removeFocusStyle( tabIndex );"> <div class="acol" ng-if="item[ spacingProperty ] > 0" ng-repeat="i in numberToArray( item[ spacingProperty ] ) track by $index"></div>  <div class="acol"><label><input class="checkbox focusable" type="checkbox" ng-disabled="itemIsDisabled( item )" ng-checked="item[ tickProperty ]" ng-click="syncItems( item, $event, $index )" /><span ng-class="{disabled:itemIsDisabled( item )}" ng-bind-html="writeLabel( item, \'itemLabel\' )"></span></label></div><span class="tickMark" ng-if="item[ groupProperty ] !== true && item[ tickProperty ] === true" ng-bind-html="icon.tickMark"></span></div></div></div></span>')}]);
