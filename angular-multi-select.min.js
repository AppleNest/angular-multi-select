var angular_multi_select=angular.module("angular-multi-select",["ng"]);
angular_multi_select.directive("angularMultiSelect",["$sce","$timeout",function(m,v){return{restrict:"AE",scope:{inputModel:"=",outputModel:"=",isDisabled:"=",onClear:"&",onClose:"&",onSearchChange:"&",onItemClick:"&",onOpen:"&",onReset:"&",onSelectAll:"&",onSelectNone:"&",translation:"="},templateUrl:"angular-multi-select.htm",link:function(a,k,c){a.backUp=[];a.varButtonLabel="";a.spacingProperty="";a.indexProperty="";a.orientationH=!1;a.orientationV=!0;a.filteredModel=[];a.inputLabel={labelFilter:""};
a.tabIndex=0;a.lang={};a.helperStatus={all:!0,none:!0,reset:!0,filter:!0};var q=0,u=[],r=0,p="",h=[],x=0,t=null;a.clearClicked=function(b){a.inputLabel.labelFilter="";a.updateFilter();a.select("clear",b)};a.numberToArray=function(a){return Array(a)};a.searchChanged=function(){if(a.inputLabel.labelFilter.length<x&&0<a.inputLabel.labelFilter.length)return!1;a.updateFilter()};a.updateFilter=function(){a.filteredModel=[];var b,d;if("undefined"===typeof a.inputModel)return!1;for(b=a.inputModel.length-
1;0<=b;b--){"undefined"!==typeof a.inputModel[b][c.groupProperty]&&!1===a.inputModel[b][c.groupProperty]&&a.filteredModel.push(a.inputModel[b]);var e=!1;if("undefined"===typeof a.inputModel[b][c.groupProperty]){if("undefined"!==typeof c.searchProperty&&""!==c.searchProperty)for(d in a.inputModel[b]){if("boolean"!==typeof a.inputModel[b][d]&&0<=String(a.inputModel[b][d]).toUpperCase().indexOf(a.inputLabel.labelFilter.toUpperCase())&&-1<c.searchProperty.indexOf(d)){e=!0;break}}else for(d in a.inputModel[b])if("boolean"!==
typeof a.inputModel[b][d]&&0<=String(a.inputModel[b][d]).toUpperCase().indexOf(a.inputLabel.labelFilter.toUpperCase())){e=!0;break}!0===e&&a.filteredModel.push(a.inputModel[b])}"undefined"!==typeof a.inputModel[b][c.groupProperty]&&!0===a.inputModel[b][c.groupProperty]&&("undefined"!==typeof a.filteredModel[a.filteredModel.length-1][c.groupProperty]&&!1===a.filteredModel[a.filteredModel.length-1][c.groupProperty]?a.filteredModel.pop():a.filteredModel.push(a.inputModel[b]))}a.filteredModel.reverse();
v(function(){a.getFormElements();if(a.inputLabel.labelFilter.length>x){var b=[];angular.forEach(a.filteredModel,function(d,e){if("undefined"!==typeof d&&"undefined"===typeof d[c.groupProperty]){var f=angular.copy(d),f=b.push(f);delete b[f-1][a.indexProperty];delete b[f-1][a.spacingProperty]}});a.onSearchChange({data:{keyword:a.inputLabel.labelFilter,result:b}})}},0)};a.getFormElements=function(){h=[];var b,c=[],e=[],l=[],g=[];a.helperStatus.all||a.helperStatus.none||a.helperStatus.reset?(c=k.children().children().next().children().children()[0].getElementsByTagName("button"),
a.helperStatus.filter&&(e=k.children().children().next().children().children().next()[0].getElementsByTagName("input"),g=k.children().children().next().children().children().next()[0].getElementsByTagName("button"))):a.helperStatus.filter&&(e=k.children().children().next().children().children()[0].getElementsByTagName("input"),g=k.children().children().next().children().children()[0].getElementsByTagName("button"));l=a.helperStatus.all||a.helperStatus.none||a.helperStatus.reset||a.helperStatus.filter?
k.children().children().next().children().next()[0].getElementsByTagName("input"):k.children().children().next()[0].getElementsByTagName("input");for(b=0;b<c.length;b++)h.push(c[b]);for(b=0;b<e.length;b++)h.push(e[b]);for(b=0;b<g.length;b++)h.push(g[b]);for(b=0;b<l.length;b++)h.push(l[b])};a.isGroupMarker=function(a,d){return!("undefined"===typeof a[c.groupProperty]||a[c.groupProperty]!==d)};a.removeGroupEndMarker=function(a){return!("undefined"!==typeof a[c.groupProperty]&&!1===a[c.groupProperty])};
a.syncItems=function(b,d,e){d.preventDefault();d.stopPropagation();if("undefined"!==typeof c.disableProperty&&!0===b[c.disableProperty]||"undefined"!==typeof c.isDisabled&&!0===a.isDisabled||"undefined"!==typeof b[c.groupProperty]&&!1===b[c.groupProperty])return!1;var l=a.filteredModel.indexOf(b),g;if("undefined"!==typeof b[c.groupProperty]&&!0===b[c.groupProperty]){if("undefined"!==typeof c.selectionMode&&"SINGLE"===c.selectionMode.toUpperCase())return!1;var n,f,h=0,k=a.filteredModel.length-1,m=
[],p=0;for(n=l;n<a.filteredModel.length&&!(0===p&&n>l);n++)if("undefined"!==typeof a.filteredModel[n][c.groupProperty]&&!0===a.filteredModel[n][c.groupProperty])0===m.length&&(h=n+1),p+=1;else if("undefined"!==typeof a.filteredModel[n][c.groupProperty]&&!1===a.filteredModel[n][c.groupProperty]){if(--p,0<m.length&&0===p){g=!0;k=n;for(f=0;f<m.length;f++)if("undefined"!==typeof m[f][a.tickProperty]&&!1===m[f][a.tickProperty]){g=!1;break}if(!0===g)for(f=h;f<=k;f++)"undefined"===typeof a.filteredModel[f][c.groupProperty]&&
("undefined"===typeof c.disableProperty?(a.filteredModel[f][a.tickProperty]=!1,g=a.filteredModel[f][a.indexProperty],a.inputModel[g][a.tickProperty]=!1):!0!==a.filteredModel[f][c.disableProperty]&&(a.filteredModel[f][a.tickProperty]=!1,g=a.filteredModel[f][a.indexProperty],a.inputModel[g][a.tickProperty]=!1));else for(f=h;f<=k;f++)"undefined"===typeof a.filteredModel[f][c.groupProperty]&&("undefined"===typeof c.disableProperty?(a.filteredModel[f][a.tickProperty]=!0,g=a.filteredModel[f][a.indexProperty],
a.inputModel[g][a.tickProperty]=!0):!0!==a.filteredModel[f][c.disableProperty]&&(a.filteredModel[f][a.tickProperty]=!0,g=a.filteredModel[f][a.indexProperty],a.inputModel[g][a.tickProperty]=!0))}}else m.push(a.filteredModel[n])}else{if("undefined"!==typeof c.selectionMode&&"SINGLE"===c.selectionMode.toUpperCase()){for(n=0;n<a.filteredModel.length;n++)a.filteredModel[n][a.tickProperty]=!1;for(n=0;n<a.inputModel.length;n++)a.inputModel[n][a.tickProperty]=!1;a.filteredModel[l][a.tickProperty]=!0}else a.filteredModel[l][a.tickProperty]=
!a.filteredModel[l][a.tickProperty];g=a.filteredModel[l][a.indexProperty];a.inputModel[g][a.tickProperty]=a.filteredModel[l][a.tickProperty]}t=angular.copy(b);null!==t&&v(function(){delete t[a.indexProperty];delete t[a.spacingProperty];a.onItemClick({data:t});t=null},0);a.refreshOutputModel();a.refreshButton();q=a.tabIndex;a.tabIndex=e+r;d.target.focus();a.removeFocusStyle(q);a.setFocusStyle(a.tabIndex);"undefined"!==typeof c.selectionMode&&"SINGLE"===c.selectionMode.toUpperCase()&&a.toggleCheckboxes(d)};
a.refreshOutputModel=function(){a.outputModel?a.outputModel.length=0:a.outputModel=[];var b=[],d={};"undefined"!==typeof c.outputProperties?(b=c.outputProperties.split(" "),angular.forEach(a.inputModel,function(e,l){if("undefined"!==typeof e&&"undefined"===typeof e[c.groupProperty]&&!0===e[a.tickProperty]){d={};angular.forEach(e,function(a,c){-1<b.indexOf(c)&&(d[c]=a)});var g=a.outputModel.push(d);delete a.outputModel[g-1][a.indexProperty];delete a.outputModel[g-1][a.spacingProperty]}})):angular.forEach(a.inputModel,
function(b,d){if("undefined"!==typeof b&&"undefined"===typeof b[c.groupProperty]&&!0===b[a.tickProperty]){var g=angular.copy(b),g=a.outputModel.push(g);delete a.outputModel[g-1][a.indexProperty];delete a.outputModel[g-1][a.spacingProperty]}})};a.refreshButton=function(){a.varButtonLabel="";var b=0;if(0===a.outputModel.length)a.varButtonLabel=a.lang.nothingSelected;else{var d=a.outputModel.length;"undefined"!==typeof c.maxLabels&&""!==c.maxLabels&&(d=c.maxLabels);a.more=a.outputModel.length>d;angular.forEach(a.inputModel,
function(e,l){"undefined"!==typeof e&&!0===e[c.tickProperty]&&(b<d&&(a.varButtonLabel+=(0<a.varButtonLabel.length?'</div>, <div class="buttonLabel">':'<div class="buttonLabel">')+a.writeLabel(e,"buttonLabel")),b++)});!0===a.more&&(0<d&&(a.varButtonLabel+=", ... "),a.varButtonLabel+="("+a.outputModel.length+")")}a.varButtonLabel=m.trustAsHtml(a.varButtonLabel+'<span class="caret"></span>')};a.itemIsDisabled=function(b){return"undefined"!==typeof c.disableProperty&&!0===b[c.disableProperty]?!0:!0===
a.isDisabled};a.writeLabel=function(a,d){var e=c[d].split(" "),l="";angular.forEach(e,function(c,d){if(a[c])l+="&nbsp;"+a[c];else if(1!==c.split(".").length){var e=c.split(".").reduce(function(a,b){return a[b]},a);l+=void 0===e?c:"&nbsp;"+e}else l+=c});return"BUTTONLABEL"===d.toUpperCase()?l:m.trustAsHtml(l)};a.toggleCheckboxes=function(b){b=k.children()[0];angular.element(document).off("click touchstart",a.externalClickListener);angular.element(document).off("keydown",a.keyboardListener);if(angular.element(p).hasClass("show"))angular.element(p).removeClass("show"),
angular.element(b).removeClass("buttonClicked"),angular.element(document).off("click touchstart",a.externalClickListener),angular.element(document).off("keydown",a.keyboardListener),a.removeFocusStyle(a.tabIndex),"undefined"!==typeof h[a.tabIndex]&&h[a.tabIndex].blur(),v(function(){a.onClose()},0),k.children().children()[0].focus();else{a.inputLabel.labelFilter="";a.updateFilter();u=[];r=0;angular.element(p).addClass("show");angular.element(b).addClass("buttonClicked");angular.element(document).on("click touchstart",
a.externalClickListener);angular.element(document).on("keydown",a.keyboardListener);a.getFormElements();a.tabIndex=0;b=angular.element(k[0].querySelector(".helperContainer"))[0];if("undefined"!==typeof b){for(var c=0;c<b.getElementsByTagName("BUTTON").length;c++)u[c]=b.getElementsByTagName("BUTTON")[c];r=u.length+b.getElementsByTagName("INPUT").length}k[0].querySelector(".inputFilter")?(k[0].querySelector(".inputFilter").focus(),a.tabIndex=a.tabIndex+r-2,angular.element(k).children()[0].blur()):a.isDisabled||
(a.tabIndex+=r,0<a.inputModel.length&&(h[a.tabIndex].focus(),a.setFocusStyle(a.tabIndex),angular.element(k).children()[0].blur()));a.onOpen()}};a.externalClickListener=function(b){for(var c=k.find(b.target.tagName),e=0;e<c.length;e++)if(b.target==c[e])return;angular.element(p.previousSibling).removeClass("buttonClicked");angular.element(p).removeClass("show");angular.element(document).off("click touchstart",a.externalClickListener);angular.element(document).off("keydown",a.keyboardListener);v(function(){a.onClose()},
0);k.children().children()[0].focus()};a.select=function(b,d){a.tabIndex=u.indexOf(d.target);switch(b.toUpperCase()){case "ALL":angular.forEach(a.filteredModel,function(b,d){"undefined"!==typeof b&&!0!==b[c.disableProperty]&&"undefined"===typeof b[c.groupProperty]&&(b[a.tickProperty]=!0)});a.refreshOutputModel();a.refreshButton();a.onSelectAll();break;case "NONE":angular.forEach(a.filteredModel,function(b,d){"undefined"!==typeof b&&!0!==b[c.disableProperty]&&"undefined"===typeof b[c.groupProperty]&&
(b[a.tickProperty]=!1)});a.refreshOutputModel();a.refreshButton();a.onSelectNone();break;case "RESET":angular.forEach(a.filteredModel,function(b,d){"undefined"===typeof b[c.groupProperty]&&"undefined"!==typeof b&&!0!==b[c.disableProperty]&&(b[a.tickProperty]=a.backUp[b[a.indexProperty]][a.tickProperty])});a.refreshOutputModel();a.refreshButton();a.onReset();break;case "CLEAR":a.tabIndex+=1;a.onClear();break;case "FILTER":a.tabIndex=u.length-1}};a.prepareGrouping=function(){var b=0;angular.forEach(a.filteredModel,
function(d,e){d[a.spacingProperty]=b;!0===d[c.groupProperty]?b+=2:!1===d[c.groupProperty]&&(b-=2)})};a.prepareIndex=function(){var b=0;angular.forEach(a.filteredModel,function(c,e){c[a.indexProperty]=b;b++})};a.keyboardListener=function(b){var c=b.keyCode?b.keyCode:b.which,e=!1;if(27===c)b.preventDefault(),b.stopPropagation(),a.toggleCheckboxes(b);else if(40===c||39===c||!b.shiftKey&&9==c)for(e=!0,q=a.tabIndex,a.tabIndex++,a.tabIndex>h.length-1&&(a.tabIndex=0,q=h.length-1);!0===h[a.tabIndex].disabled&&
(a.tabIndex++,a.tabIndex>h.length-1&&(a.tabIndex=0),a.tabIndex!==q););else if(38===c||37===c||b.shiftKey&&9==c)for(e=!0,q=a.tabIndex,a.tabIndex--,0>a.tabIndex&&(a.tabIndex=h.length-1,q=0);!0===h[a.tabIndex].disabled;){a.tabIndex--;if(a.tabIndex===q)break;0>a.tabIndex&&(a.tabIndex=h.length-1)}!0===e&&(b.preventDefault(),h[a.tabIndex].focus(),"CHECKBOX"===document.activeElement.type.toUpperCase()?(a.setFocusStyle(a.tabIndex),a.removeFocusStyle(q)):(a.removeFocusStyle(q),a.removeFocusStyle(r),a.removeFocusStyle(h.length-
1)))};a.setFocusStyle=function(a){angular.element(h[a]).parent().parent().parent().addClass("multiSelectFocus")};a.removeFocusStyle=function(a){angular.element(h[a]).parent().parent().parent().removeClass("multiSelectFocus")};a.groupProperty=c.groupProperty;a.tickProperty=c.tickProperty;a.directiveId=c.directiveId;var w=function(a){for(var c="",e=0;e<a;e++)c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random()));return c}(5);a.indexProperty="idx_"+w;a.spacingProperty=
"spc_"+w;"undefined"!==typeof c.orientation&&("HORIZONTAL"===c.orientation.toUpperCase()?(a.orientationH=!0,a.orientationV=!1):(a.orientationH=!1,a.orientationV=!0));p=k.children().children().next()[0];"undefined"!==typeof c.maxHeight&&(w=k.children().children().children()[0],angular.element(w).attr("style","height:"+c.maxHeight+"; overflow-y:scroll;"));for(var y in a.helperStatus)a.helperStatus.hasOwnProperty(y)&&"undefined"!==typeof c.helperElements&&-1===c.helperElements.toUpperCase().indexOf(y.toUpperCase())&&
(a.helperStatus[y]=!1);"undefined"!==typeof c.selectionMode&&"SINGLE"===c.selectionMode.toUpperCase()&&(a.helperStatus.all=!1,a.helperStatus.none=!1);a.icon={};a.icon.selectAll="&#10003;";a.icon.selectNone="&times;";a.icon.reset="&#8630;";a.icon.tickMark="&#10003;";"undefined"!==typeof c.translation?(a.lang.selectAll=m.trustAsHtml(a.icon.selectAll+"&nbsp;&nbsp;"+a.translation.selectAll),a.lang.selectNone=m.trustAsHtml(a.icon.selectNone+"&nbsp;&nbsp;"+a.translation.selectNone),a.lang.reset=m.trustAsHtml(a.icon.reset+
"&nbsp;&nbsp;"+a.translation.reset),a.lang.search=a.translation.search,a.lang.nothingSelected=m.trustAsHtml(a.translation.nothingSelected)):(a.lang.selectAll=m.trustAsHtml(a.icon.selectAll+"&nbsp;&nbsp;Select All"),a.lang.selectNone=m.trustAsHtml(a.icon.selectNone+"&nbsp;&nbsp;Select None"),a.lang.reset=m.trustAsHtml(a.icon.reset+"&nbsp;&nbsp;Reset"),a.lang.search="Search...",a.lang.nothingSelected="None Selected");a.icon.tickMark=m.trustAsHtml(a.icon.tickMark);"undefined"!==typeof c.MinSearchLength&&
0<parseInt(c.MinSearchLength,10)&&(x=Math.floor(parseInt(c.MinSearchLength,10)));a.$watch("inputModel",function(b){b&&(a.refreshOutputModel(),a.refreshButton())},!0);a.$watch("inputModel",function(b){b&&(a.backUp=angular.copy(a.inputModel),a.updateFilter(),a.prepareGrouping(),a.prepareIndex(),a.refreshOutputModel(),a.refreshButton())});a.$watch("isDisabled",function(b){a.isDisabled=b});var z=function(b){a.$apply(function(){a.scrolled=!1})};angular.element(document).bind("touchstart",z);var A=function(b){a.$apply(function(){a.scrolled=
!0})};angular.element(document).bind("touchmove",A);a.$on("$destroy",function(){angular.element(document).unbind("touchstart",z);angular.element(document).unbind("touchmove",A)})}}}]);angular_multi_select.run(["$templateCache",function(m){m.put("angular-multi-select.htm",'<span class="multiSelect inlineBlock"><button id="{{directiveId}}" type="button"ng-click="toggleCheckboxes( $event ); refreshSelectedItems(); refreshButton(); prepareGrouping; prepareIndex();"ng-bind-html="varButtonLabel"ng-disabled="disable-button"></button><div class="checkboxLayer"><div class="helperContainer" ng-if="helperStatus.filter || helperStatus.all || helperStatus.none || helperStatus.reset "><div class="line" ng-if="helperStatus.all || helperStatus.none || helperStatus.reset "><button type="button" class="helperButton"ng-disabled="isDisabled"ng-if="helperStatus.all"ng-click="select( \'all\', $event );"ng-bind-html="lang.selectAll"></button><button type="button" class="helperButton"ng-disabled="isDisabled"ng-if="helperStatus.none"ng-click="select( \'none\', $event );"ng-bind-html="lang.selectNone"></button><button type="button" class="helperButton reset"ng-disabled="isDisabled"ng-if="helperStatus.reset"ng-click="select( \'reset\', $event );"ng-bind-html="lang.reset"></button></div><div class="line" style="position:relative" ng-if="helperStatus.filter"><input placeholder="{{lang.search}}" type="text"ng-click="select( \'filter\', $event )" ng-model="inputLabel.labelFilter" ng-change="searchChanged()" class="inputFilter"/><button type="button" class="clearButton" ng-click="clearClicked( $event )" >\u00d7</button> </div> </div> <div class="checkBoxContainer"><div ng-repeat="item in filteredModel | filter:removeGroupEndMarker" class="multiSelectItem"ng-class="{selected: item[ tickProperty ], horizontal: orientationH, vertical: orientationV, multiSelectGroup:item[ groupProperty ], disabled:itemIsDisabled( item )}"ng-click="syncItems( item, $event, $index );" ng-mouseleave="removeFocusStyle( tabIndex );"> <div class="acol" ng-if="item[ spacingProperty ] > 0" ng-repeat="i in numberToArray( item[ spacingProperty ] ) track by $index"></div>  <div class="acol"><label><input class="checkbox focusable" type="checkbox" ng-disabled="itemIsDisabled( item )" ng-checked="item[ tickProperty ]" ng-click="syncItems( item, $event, $index )" /><span ng-class="{disabled:itemIsDisabled( item )}" ng-bind-html="writeLabel( item, \'itemLabel\' )"></span></label></div><span class="tickMark" ng-if="item[ groupProperty ] !== true && item[ tickProperty ] === true" ng-bind-html="icon.tickMark"></span></div></div></div></span>')}]);
